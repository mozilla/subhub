[tox]
minversion = 3.5.0
envlist = py37-{sub,hub,shared}
skipsdist=true

[testenv]
run_before =
  ps -ef | grep -i dynalite | awk '{print $2}' | xargs kill -9 2&> /dev/null
  ps -ef | grep -i kinesalite | awk '{print $2}' | xargs kill -9 2&> /dev/null
  export AWS_XRAY_SDK_ENABLED=false

envdir = {toxinidir}/venv
changedir =
    sub: {toxinidir}/src/sub
    hub: {toxinidir}/src/hub
    shared: {toxinidir}/src/shared
passenv =
  STRIPE_API_KEY
  USER_TABLE
  EVENT_TABLE
  PAYMENT_API_KEY
  SUPPORT_API_KEY
  HUB_API_KEY
  SALESFORCE_BASKET_URI
  AWS_REGION
  FXA_SQS_URI
deps =
  -r src/test_requirements.txt
  .[test]
  tox-run-before
  codecov

commands =
    sub: pytest --cov=sub --cov-report term --capture=no {posargs}
    hub: pytest --cov=hub --cov-report term --capture=no {posargs}
    hub: pytest --cov=shared --cov-report term --capture=no {posargs}

[pytest]
norecursedirs = docs *.egg-info .git appdir .tox .venv env
