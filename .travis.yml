language: python
dist: xenial
cache:
  directories:
    - /home/travis/.nvm
    - /home/travis/.cache/pip
python:
  - "3.7"
env:
  global:
    - BOTO_CONFIG: "/dev/null"
    - AWS_XRAY_SDK_ENABLED: false
    - DEPLOYED_ENV: travis

before_install:
  - sudo rm -f /etc/boto.cfg
  - pip install -r automation_requirements.txt
  - npm install -g dynalite
  - npm install -g kinesalite
  - sudo apt-get install -y awscli
  - ./bin/aws-credentials.sh

jobs:
  include:
    - stage: Unit Tests
      script:
        - doit test
        - cd /home/travis/build/mozilla/subhub/src/sub && bash <(curl -s https://codecov.io/bash) -cF python
        - cd /home/travis/build/mozilla/subhub/src/hub && bash <(curl -s https://codecov.io/bash) -cF python
