FROM mozilla/subhub-base:latest
MAINTAINER Stewart Henderson <shenderson@mozilla.com>

ARG STRIPE_API_KEY
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG LOCAL_HUB_FLASK_PORT
ARG SUPPORT_API_KEY
ARG DYNALITE_PORT

ENV STRIPE_API_KEY=$STRIPE_API_KEY \
    AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
    AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
    LOCAL_HUB_FLASK_PORT=$LOCAL_HUB_FLASK_PORT \
    HUB_API_KEY=$HUB_API_KEY \
    DYNALITE_PORT=$DYNALITE_PORT \
    USER_TABLE=$USER_TABLE \
    DELETED_USER_TABLE=$DELETED_USER_TABLE \
    EVENT_TABLE=$EVENT_TABLE \
    FLASK_ENV=development

EXPOSE $LOCAL_FLASK_PORT

RUN mkdir -p /subhub
ADD .src.tar.gz /subhub/hub
WORKDIR /subhub
ENV PYTHONPATH=.
